# MathGraph Lab — 現状の機能一覧とアップグレード案

## 1. 現状の機能リスト（整理）

### 1.1 グラフ表示・操作

| カテゴリ | 機能 | 説明 |
|----------|------|------|
| **グラフ** | 放物線の表示 | y = a(x - p)² + q。a, p, q をスライダーで変更可能。表示 ON/OFF 可能（現状パネルからは常時表示）。 |
| **グラフ** | 直線の表示 | y = mx + n。m, n をスライダーで変更可能。表示 ON/OFF 可能（現状パネルからは常時表示）。 |
| **グラフ** | 交点の自動計算・表示 | 放物線と直線の交点を緑の点で表示。0個・1個（接線）・2個のいずれか。 |
| **グラフ** | 交点からのドロップライン | 交点から x 軸まで破線で垂線を表示。 |
| **操作** | パン（ドラッグ） | グラフ領域を指でドラッグして移動。 |
| **操作** | ピンチズーム | 拡大・縮小（0.5〜5.0倍程度）。 |
| **操作** | 触覚フィードバック | ズーム終了時などにハプティック（設定で ON/OFF）。 |

### 1.2 数式・ラベル

| カテゴリ | 機能 | 説明 |
|----------|------|------|
| **数式** | 放物線の式表示 | 画面上部に「y = a(x-p)²+q」形式で表示（小数・分数表記対応のロジックあり）。 |
| **数式** | 直線の式表示 | 画面上部に「y = mx + n」形式で表示。 |
| **数式** | 式ラベルのドラッグ | 数式ラベルをドラッグして位置を変更可能。 |
| **数式** | ラベル位置リセット | 旧パネルにあった「矢印で戻す」で式の位置を初期化（現状はメニュー等からは未露出の可能性あり）。 |

### 1.3 設定・UI

| カテゴリ | 機能 | 説明 |
|----------|------|------|
| **テーマ** | ライト / ダーク / 黒板 | 3種類のテーマ。右下コックピットパネル内で切り替え。 |
| **パネル** | 右下コックピット | 設定ボタンで開閉。テーマ・ƒ(x) 放物線パラメータ・ℓ(x) 直線パラメータを一括操作。 |
| **パネル** | スライダー操作中の透明化 | パラメータをいじっている間だけパネルを半透明にし、グラフの並行移動が見やすいようにする。 |
| **設定** | グリッドにスナップ | パラメータが整数にスナップ（右上メニューで ON/OFF）。 |
| **設定** | 触覚フィードバック | 右上メニューで ON/OFF。 |
| **設定** | グラフを初期状態に戻す | 右上メニューからリセット。放物線・直線・ズーム・パン・作図系をクリア。 |
| **設定** | Settings タブ | 環境設定（グリッド吸着・触覚）、外観（テーマ）、アップグレード（Pro・広告非表示）、バージョン表示。 |

### 1.4 面積・作図・距離（実装済み・UI は一部未露出）

| カテゴリ | 機能 | 説明 |
|----------|------|------|
| **面積** | 交点と原点の三角形の面積 | MathSolver で計算。AnalysisOverlayView で「S = 〇.〇〇」と三角形の塗りつぶし表示（**isAreaModeEnabled が true のとき**）。現状 ON にする UI がコックピットにない。 |
| **作図** | グラフ上タップで点の追加 | 作図モード時、タップで座標を打点（**isGeometryModeEnabled が true のとき**）。A, B, C... とラベル＋座標表示。 |
| **作図** | 2点を通る直線の作成 | 2点を打ったあと「この2点を通る直線を作成」で直線の m, n を自動計算。現状この UI は旧パネルにあったため、コックピットからは利用不可の可能性。 |
| **距離** | 打った点どうしの距離 | 隣り合う点を線で結び、線分の長さを表示（**showDistances が true のとき**）。現状 ON にする UI がコックピットにない。 |

※ 面積・作図・距離は **AppState と各 Overlay で実装済み**だが、現在のコックピットにはトグルがなく、**デフォルトではオフ**。必要なら設定やメニュー、またはパネルにスイッチを追加する必要あり。

### 1.5 その他

| カテゴリ | 機能 | 説明 |
|----------|------|------|
| **シェア** | スクリーンショット共有 | ツールバー左の共有ボタンで画面をキャプチャしシェアシート表示。 |
| **広告** | バナー広告 | 画面下部（isAdRemoved が false のとき）。課金で非表示の想定。 |
| **Pro** | Pro モード（設定画面） | 平行移動(p,q)・黒板テーマ・作図機能の解放（IAP はモック）。 |
| **アプリ構成** | TabView | Graph Lab タブ / Settings タブ。 |

---

## 2. あるとよい実装・機能（アップグレード案）

以下は「現状を維持したうえで追加するとよい」案。**実装はまだ行わない**前提でリスト化。

### 2.1 座標・数値の見せ方

- **任意点の座標表示**  
  グラフ上を長押し or ドラッグ中に、その位置の (x, y) をリアルタイム表示（例：十字カーソル＋ツールチップ）。
- **交点座標の明示**  
  交点の近くに「(x₁, y₁)」「(x₂, y₂)」を常時 or タップで表示。
- **頂点の座標表示**  
  放物線の頂点 (p, q) をラベルで表示。
- **切片の強調**  
  直線の y 切片 (0, n) をマークして「n」を表示。

### 2.2 面積・積分まわり

- **面積モードの ON/OFF を UI で**  
  コックピット or メニューに「面積表示」トグルを追加し、isAreaModeEnabled を切り替え可能に。
- **面積の計算式の表示**  
  「S = ½|n|×|x₂−x₁|」や「S = 〇.〇〇」をパネル or 吹き出しで表示。
- **2交点と軸で囲まれた領域の面積**  
  現状は「原点＋2交点」の三角形のみ。必要なら「x 軸・y 軸・直線・放物線で囲まれた領域」の面積など、教育用に1パターン追加。

### 2.3 作図・距離の見せ方

- **作図・距離の ON/OFF を UI で**  
  コックピット or メニューに「作図モード」「距離表示」トグルを追加し、isGeometryModeEnabled / showDistances を切り替え可能に。
- **「2点を通る直線」をコックピットから**  
  2点打点後、パネル内に「2点で直線を作成」ボタンを復活 or 新設。
- **距離の式表示**  
  「AB = √((x₂−x₁)²+(y₂−y₁)²) = 〇.〇〇」のように式と値の両方を表示。
- **中点の表示**  
  2点 A, B を指定したとき、中点 M と座標を表示。

### 2.4 グラフ・式の拡張

- **放物線の表示 ON/OFF**  
  コックピットで「放物線を非表示」にできるように（showParabolaGraph の切り替え）。
- **直線の表示 ON/OFF**  
  同様に直線の表示/非表示（showLinearGraph）。
- **中学モード / 高校モード**  
  p, q を隠す「y = ax²」のみのモードと、p, q ありのモードを、パネル or 設定で切り替え（showAdvancedParabola の露出）。
- **係数の分数入力**  
  現在はスライダーのみ。小数⇔分数の切り替えや分数入力 UI をパネルに復活させる案。

### 2.5 使いやすさ・教育向け

- **ヒント・チュートリアル**  
  初回 or ヘルプボタンで「スライダーで形が変わる」「交点が0・1・2の意味」などを短いテキストで説明。
- **プリセット**  
  「放物線と直線が接する」「2交点がきれいな数」など、ワンタップでパラメータをセットするボタン。
- **履歴・Undo**  
  パラメータ変更の1歩戻す（previousParabola / previousLine の活用）。
- **倍率・グリッドの表示**  
  現在のズーム倍率や「1マス = 1」などのテキストを隅に表示。

### 2.6 出力・連携

- **画像・PDF の保存**  
  現在はシェアのみ。カメラロール保存や PDF 出力オプション。
- **グラフのデータ export**  
  現在の a, p, q, m, n や交点座標をテキスト/CSV でコピー or 書き出し。
- **授業用の固定倍率**  
  プロジェクター用に「1:1 ピクセル」や「常に -5〜5 表示」などの固定スケールモード。

### 2.7 その他

- **アクセシビリティ**  
  VoiceOver 用ラベル、コントラスト設定、フォントサイズの拡大。
- **iPad / 横画面**  
  余白を活かしたサイドパネルや、2分割（グラフ｜パネル）レイアウト。
- **ウィジェット**  
  今日のグラフや「今の式」をホーム画面に表示（将来案）。

---

## 3. まとめ

- **現状**  
  放物線・直線のリアルタイム編集、交点・ドロップライン・面積（三角形）・作図・距離の**計算と描画**は実装済み。テーマ・コックピット・スライダー中の透明化まで含め、すでにかなり完成度が高い。
- **ギャップ**  
  面積・作図・距離の **ON/OFF を切り替える UI** と、「2点で直線を作成」が現在のコックピットからは使えない状態。
- **アップグレード**  
  上記は「座標・面積の見せ方」「作図・距離の UI 露出」「式の ON/OFF・中学/高校モード」「ヒント・プリセット・履歴」「出力・アクセシビリティ」など、段階的に選んで実装できる案として整理した。

実装する際は、この中から優先度の高いものから順に「小さく実装→テスト」するのがおすすめです。
